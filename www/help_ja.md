## ChargeLimiter
ChargeLimiter(CL)はMacOS版AlDenteにインスパイアされたもので、iDeviceが過充電になるのを防ぎ、バッテリーへのダメージを防ぐために使用します。    
Rootful Jailbreak（arm.deb）/Rootless Jailbreak（arm64.deb）/TrollStore（.tipa）をサポートしています。現在、iOS12-17.0をサポートしています。（注意：TrollStoreを使用する場合は、新しいバージョンをインストールする前に古いバージョンのCLをアンインストールしてください）       
iPhone6/7+iOS12/13 Checkra1n/Unc0ver/Odyssey、iPhone7/X/11+iOS15/16 Palera1n/Dopamine/TrollStoreでテスト済み。 
v1.4.1はほとんどのユーザー向け、v1.5はChargeInhibitをサポートしていないバッテリー向け、v1.6は充電中のアンペア数が大きすぎるバッテリー向けです。   
このプロジェクトはオープンソース化されており、より良いアイデアがあれば直接コードを提出してください。ご意見があればissue regionに提出してください。このソフトウェアはオープンソース化され、永遠に無料かつ広告なしで提供されます。このソフトウェアが原因でiOSシステムやハードウェアに影響が生じた場合、著者は一切の責任を負いません。 
既知の問題
* テスト用のデバイスが不足しているため、CLはiOS<=11ではサポートされない可能性があります。
* iOS<=12ではフローティングウィンドウはサポートされていません。
* deb版では、一部の調整によりCLがSplashScreenで停止することがありますが、これはCL自体のバグではありません。com.apple.UIKitに注入されたこれらの調整は、/Library/MobileSubstrate/DynamicLibraries（rootful）および/var/jb/Library/MobileSubstrate/DynamicLibraries（rootless）で見つけることができます。
* システムの制限により、画面がロックされていると熱シミュレーションは利用できません。

## FAQ
CLを使う理由は？
* iDeviceが常に電源に接続されている
* iDeviceは常に夜間に充電する
* 充電中の温度を管理したい
CLはより多くの電力を消費しますか？
ほとんどのユーザーにとっては影響ありません。 アプリのUIとフローティングウィンドウは、更新頻度が1秒の場合、若干の電力が消費される可能性があります。 容量の低下が速いと感じる場合は、更新頻度を1分に設定してみてください。
CLはサードパーティ製バッテリーをサポートしていますか？
CLはほとんどのブランドのバッテリーをサポートしています。
CLを一定期間使用すると、バッテリー残量パーセンテージが増加しますか？
* 特にソフトウェアではあり得ないと思いますが、CLを1ヶ月間使用した後にバッテリー残量が増えたというユーザーも確かにいます。
* CLは、ほとんどのユーザーのバッテリー残量低下速度を遅くします。
* バッテリー健康度はある範囲で変動するかもしれません。CLを使用した後も健康度が低下し続けるユーザーはほとんどいません。この場合はCLの使用を中止してください。
* できるだけ電源に接続し続け、ChargeInhibit（DisableInflowなし）を有効にしておいてください。通常のアンペア数は0mAで、バッテリー健康度は低下しません。
なぜ私のiDeviceは充電または放電できないのですか？（初心者からの質問で最も多いもの）
CLは完全自動のツールではありません。温度制御が有効になっている場合は、実際の温度に応じて閾値を慎重に設定してください。そうしないと、CLは確実に充電を停止し、それ以上再充電を行わなくなります。
CLは充電回数を最小限に抑えるように設計されています。そのため、「プラグアンドチャージ」モードで電源に接続しても充電を開始したり充電を回復したりすることはありませんが、電源に再接続すると充電を開始します。
* 状態の悪いバッテリーでは、ChargeInhibit/DisableInflowが正常に動作しない場合があります。この場合、システムを再起動すると正常に動作しますが、数十分後にはまた動作しなくなります。CLは、この種のバッテリーでは使用できません。状態の悪いバッテリーで動作不良が起こるケースは、ごく一部です。
* 過熱したバッテリーは、ChargeInhibitの障害を引き起こす可能性があります。この場合、バッテリーが冷えると正常に再開します。過熱したバッテリーすべてに障害が発生するわけではないことにご注意ください。
* アクティベーションされていない新しいバッテリーは、5mAをはるかに上回るアンペア数になる可能性があり、完全なChargeInhibitが解除されます。
iPadの場合、バッテリーが正常に充電され、容量が増えない場合、電源の説明が「pd charger」と表示されている場合は、ケーブルを差し直したり、ケーブルや充電器をより良いものに変えてみてください。「usb brick」と表示されるまで試してみてください
CLは、JailbreakやTrollStore（のような）環境なしでインストールできますか？
CLではプライベートAPIを使用しているため、App Storeに公開することはできません。
* CLでは特別な権限が使用されているため、一般的なipaファイルとしてインストールすることはできません。
夏場のバッテリー冷却方法
* CLの「Powercuff」機能でiDeviceハードウェアの消費電力を抑えることで、充電時のワット数を減らすことができます。
* 充電にはワット数の低い充電器を使用してください。
* 放熱装置などを使用してください。
バッテリーを健康に保つ最善の方法とは？
* 参照 <https://www.apple.com.cn/batteries/maximizing-performance/>
* 極端な高温または低温での使用は避ける
* 長時間の過充電は避ける
* 電源が切れた状態は避ける
何か問題が発生した場合、CLを自分でデバッグするにはどうすればよいですか？
* 5分チャートとログ（/var/root/aldente.log）のデータを表示して、充電/放電の履歴データを検証します。
CLでパワーキラーアプリを見つけるにはどうすればよいですか？
* アプリを開くか、システム機能を有効にしてしばらく待ち、5分チャートまたはHeliumアプリのアンペア数でデータを表示して、キラーを見つけます。

## 互換性
CLを使用する前にバッテリーの互換性をテストし、サポートされていない場合はCLを停止してアンインストールしてください
* 1.ChargeInhibitの互換性を確認します。まず「有効」ボタンを切り替えてCLを無効にし、「詳細設定」内のすべてのオプションを無効にします。次に「充電」ボタンを切り替えて充電を無効にします。120秒以内に何か変化があれば、ChargeInhibitがサポートされていることを意味します。ただし、無効にした後もInstantAmperageが5mA以上を維持している場合はこの限りではありません。（InstantAmperageは、一部の種類のバッテリーでは無効になる場合があります。この場合、容量増加を確認してください。）
* 2.PredictiveChargingInhibitの互換性を確認してください。「Advanced-Predictive charging inhibit」から有効にし、その後「1」の手順に従ってください。
* 3.DisableInflowの互換性を確認してください。Enableボタンを切り替えてCLを無効にし、有効になったら「External connected」ボタンを切り替えて流入を無効にします。120秒以内に何か変化があれば、DisableInflowがサポートされていることを意味します。ただし、無効にした後もInstantAmperageが5mA以上を維持している場合はこの限りではありません（InstantAmperageは、一部の種類のバッテリーでは無効になる場合があります。この場合は、容量増加を確認してください）。
* 状態の良くないバッテリーでは、CLが正常に動作しない場合があります。この場合、システムを再起動するとCLは正常に充放電を制御できますが、数十分後には制御できなくなります。この種のバッテリーではCLは使用できません。
* ChargeInhibitもDisableInflowもサポートされていない場合、そのバッテリーはCLではサポートされません。
CLを使用中にバッテリーの状態が異常に低下し続ける場合は、アドバンスメニューで設定を調整するか、CLをアンインストールしてください。

## バッテリーの起動
公式文書：<https://www.apple.com.cn/batteries/maximizing-performance/>

## バッテリーバンクとの互換性
CLはモバイルバッテリーと併用できます。iDeviceは、まずモバイルバッテリーの電力で充電され、モバイルバッテリーの電力が切れた後にiDeviceのバッテリーが電力を供給します。これは、長距離の移動を予定しているユーザーにとって有益です。モバイルバッテリーは、バッテリーよりも容量が大きく、価格も安価です。注意：
* ワイヤレス充電のワット数が不十分な場合、バッテリーが同時に電力を供給することがあります。充電器が供給できる以上の電力を携帯電話自体が消費する場合は、ワイヤレス充電器を使用することは適していません。
* ほとんどの有線式モバイルバッテリーは「スリープモード」をサポートしており、一定時間電流が一定の閾値を下回ると、モバイルバッテリーは自動的に電源をオフにします。このモードでCLを使用している場合、携帯電話がロックされた後に電流が低くなり、モバイルバッテリーが電源をオフにすることがあります。この場合、電源が切断されているため、CLはそれ以上充電することができません。
* ほとんどの有線式モバイルバッテリーは、電源ボタンをダブルクリックするか長押しすることで「低電流モード」をサポートしており、電流が少なくなった場合でもモバイルバッテリーが自動的に電源をオフにすることはありません。このモードでは、画面がロックされた後もCLは正常に動作します。ただし、一部のモバイルバッテリーでは、数時間後に「低電流モード」が自動的に終了しますのでご注意ください。

## 注意
* iPhone8+(またはそれ以上)では、充電状態の設定後、120秒の遅延があります。iPadでも同様かもしれません。
* ChargeInhibitモードでは、システムステータスバーのライトニングアイコンは更新されず、実際の充電状況は3utools（および類似品）またはCLで確認できます。一方、DisableInflowモード（iPhone8+）では更新されます。このモードは「Advanced-Control inflow」で有効になります。
* TrollStoreの場合、CLのデーモンが何らかの理由で終了した場合（システム再起動、ユーザースペース再起動など）、CLは自動的にデーモンを再起動できないため、無効になります。
* CLは充電回数を最小限に抑えるように設計されているため、「プラグアンドチャージ」モードで電源に接続しても充電を開始または回復することはありません。充電の開始と停止は、後述の特定の条件下でのみ行われます。
* CLは、設定.appの「最適化バッテリー充電」と互換性がありません。必要に応じて、CLを無効にした後、設定.appで再度有効にしてください。最新のiDeviceでCLを使用することは推奨されません。「最適化バッテリー充電」はiPhone15からすでに完璧です。
* iDeviceがChargeInhibitモードに長時間留まっていると、ハードウェア統計が不正確になる可能性があります。少なくとも月に一度はバッテリーの充電/放電を行うことをお勧めします。

## 説明

### 条件
* ChargeInhibit: バッテリーへの電流の流れを禁止します。このモードではバッテリーは充電も放電も行わず、電源がiDeviceのハードウェアに直接電力を供給します。このモードが優先されるべきです。
* DisableInflow: iDeviceへの電流の流れを禁止します。このモードではバッテリーが放電し、iDeviceのハードウェアに電源が供給されます。このモードは、ChargeInhibitがバッテリーによってサポートされていない場合にのみ使用してください。
* LimitInflow: 電流を制限し、iDeviceの過熱を防止します。このモードは、バッテリーが電流を制御できない場合のみに使用してください。

### 「有効」ボタン
CLをグローバルに有効または無効にします。無効にすると、CLは読み取り専用のオブザーバーとなり、バッテリー情報のみを表示します。

### フローティングウィンドウ
* バッテリー情報とデーモンのステータスをリアルタイムで表示
* ドラッグして任意の場所に移動できます。
* タップするとCLをグローバルに有効または無効にします。「有効」ボタンと同じです。
* 「自動的に隠す」が有効になっている場合、他のアプリが前面にあるときは自身を隠します。

### モード
「プラグアンドチャージ」モードは個人向けで、いつでも充電と放電が可能です。トリガーは以下の通りです。
* 条件が満たされた場合、USBケーブルを再接続すると充電を開始します。
* 現在の容量が指定値より低い場合、充電を開始します。
* 現在の容量が指定値より高い場合、充電を停止します。
* 温度が指定値より低ければ充電開始。
* 温度が指定値より高ければ充電停止。
「エッジトリガー」モードは、開発者およびスタジオ向けで、iDeviceが常に電源に接続されている場合、以下のとおりにトリガーされます。
* 電流容量が指定値より低ければ充電開始。
* 電流容量が指定値より高ければ充電停止。
* 温度が指定値より高ければ充電停止。
優先順位の高いものから低いものへトリガーされます。
* 充電開始（極端に容量が低い） 
* 充電停止（容量＞温度）
* 充電開始（容量＞温度＞プラグイン）
### 更新頻度
* 更新頻度は、UIのデータ更新速度です。アプリUIとフローティングウィンドウの両方です。
* 更新頻度を低く設定すると、より多くの電力を節約できる可能性があります。ほとんどのユーザーは1秒で問題ありませんが、お好みで設定してください。
### しきい値
* デフォルトのしきい値は20/80/10/35に設定されています。CLを期待通りに動作させるには、自分で調整する必要があります。
* 温度のしきい値は「履歴-時間ごとのデータ」に従って設定してください。
* トリガーで停止する実際の値は、必ずしも目標値と一致するとは限りません。ほとんどの状況では、その差は0～1%ですが、一部のユーザーでは3～5%の差が生じます。この差は、「120秒の遅延」、充電速度、およびバッテリーハードウェア自体と何らかの関係があります。充電停止後に弱いアンペアが発生した場合、その差は3%より高くなる可能性があります。また、バッテリーの健康状態が突然変化した場合にも、このような状況が発生する可能性があります。活性化されていない新しいバッテリーがこのような状況を引き起こす可能性があります。
### アクション
充電の開始/停止のトリガーに対するアクション。CLを再インストール/更新した後は、リセットしてください。
### 詳細
* 「スマートバッテリー」と「予測充電抑制」については、ほとんどのユーザーにとってデフォルト設定が最適です。 これらを再設定して、最適な設定を見つけてください。
* 「流入自動抑制」と「DisableInflow」モードは、ChargeInhibitモードをサポートしていないバッテリー用です。有効にすると、充電を停止した後、iDeviceがバッテリーの電力を消費し始めます。
* 熱シミュレーション、Powercuffと同じで、温度が高ければ高いほど、ハードウェア（充電器/CPU/GPU/バックライト/WiFi/ラジオ/スピーカー/アークなど）の消費電力は少なくなり、パフォーマンスは低下し、充電電流と充電電圧は低下します。iOSシステム自体が実際の状況に応じてステータスを更新します。特定の値を強制的に変更したい場合は（推奨しません）、「ロック」を有効にしてください。脱獄環境下で同様の機能を持つ他のTweakと競合した場合、CLは無効になります。
* ピークパワー：低温または低容量時のピークパワー性能を制御します。変更する場合は、何を変更するのかを理解している場合のみ行ってください。
* 自動流入制限、高温およびバッテリーの健康状態低下によるアンペア数の制御不能に対して熱シミュレーションを適用します。この方法で不安定なレベルを見つけることができます。電流容量が30%以下になったら充電を開始します（容量が低いほど、アンペア数は高くなります）。「高度な-熱シミュレーション」レベルを選択します（「標準」から「重い」まで、レベルが高いほどアンペア数は低くなります）。アンペア数は数秒で変化します。許容できるアンペア値が見つかったら、レベルを「高度-自動流入制限-熱シミュレーション」に設定します。この場合、CLが充電を開始すると、熱シミュレーションレベルは「高度-自動流入制限-熱シミュレーション」で指定したレベルに自動的に設定され、CLが充電を停止すると、デフォルトのレベルである「高度-熱シミュレーション」に設定されます。
### バッテリー情報
* バッテリーの健康度は NominalChargeCapacity で計算されます。一般的に、新品のバッテリーの健康度は100%を超えており、システムステータスバーでは常に100%と表示されます。長期間にわたるChargeInhibitにより、健康度が突然大幅に低下する可能性があることにご注意ください。この場合、CLを一時的に無効にして、バッテリーを完全に充電する操作を数回繰り返すことで、健康度を回復させることができます。
* ハードウェア容量はシステム容量に近く、ほとんどの場合、より正確です。違いが大きすぎる場合は、バッテリーが較正されていないか、品質が悪いことを示している可能性があります。過充電の場合は、ハードウェア容量が100% (システムステータスバーでは100%) を超える可能性があり、過放電の場合は、マイナス (システムステータスバーでは0) になる可能性があります。
* InstantAmperage が正の値の場合は電源からバッテリーへの電流の流れを意味し、負の場合は電源なしでバッテリーからiDeviceへの電流の流れを意味します。InstantAmperage は通常、ChargeInhibit モードでは 0mA であるべきです。この場合、電流はバッテリーを通ってiDeviceに流れます。バッテリーを直接電源として使用するよりもバッテリーへのダメージは少なくなります。（*実際には、電源に接続したまま充電を停止すると、バッテリーの健康状態が低下することはありません*）。InstantAmperageはDisableInflowモードでは負の値であるべきです。
### 履歴
&emsp;&emsp;一定期間のバッテリーの状態を表示します。時間を変更するには水平にスライドさせ、凡例をクリックして特定のソースを隠したり表示したりします。
* 5分間隔のデータ、電流容量/温度/電流を含む、各充電または放電サイクルにおけるバッテリーの状態を詳細に表示します。
* 1時間ごとのデータ、すべての充電または放電サイクルにおけるバッテリーの状態を表示（電流容量/温度/電流を含む）。
* 1日ごとのデータ、各日のバッテリーの状態を詳細に表示。
* 1か月ごとのデータ、各月のバッテリーの状態を表示。
### For Shortcuts.app
新規ショートカット - アクションの追加 - Web - Safari - URLを開く 
* cl:///                         (CLを開く)
* cl:///exit                   (CLを開き、CLを終了し、デーモンを起動するのみ)
* cl:///charge              (CLを開き、充電を開始する)
* cl:///charge/exit       (CLを開き、充電を開始し、CLを終了する)
* cl:///nocharge         (CLを開き、充電を停止する)
* cl:///nocharge/exit  (CLを開き、充電を停止し、CLを終了する)
統合ショートカット（iOS16+）： <https://www.icloud.com/shortcuts/2ec3aed94f414378918f3e082b7bf6b0>
